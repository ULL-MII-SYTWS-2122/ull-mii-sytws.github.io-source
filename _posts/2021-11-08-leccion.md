---
layout: post
title:  "Clase  del Lunes 08/11/2021 (Semana C)"
categories: Clases
visible: true
---



## Exercises on Asynchronous JS

### Comparing Performances: Sync vs Async and REST vs GraphQL in the gh-org-members extension

Véase [crguezl/gh-org-members/gh-org-members.js](https://github.com/crguezl/gh-org-members/blob/main/gh-org-members.js)

| REST Seq    | REST Parallel | GraphQL     |
| :---:       |   :----:      |    :---:    |
| 12,754      | 3,3           | 1,5         |


```
// rest sequential branch: sequential
// 3,31s user 1,16s system 35% cpu 12,754 total
// 3,36s user 1,18s system 35% cpu 12,784 total

// REST parallel console.log at the end. branch print-at-the-end
// 2,84s user 1,11s system 122% cpu 3,218 total
// 2,73s user 1,08s system 119% cpu 3,193 total

// REST parallel: print as soon as it is available. branch: main
// 2,92s user 1,18s system 119% cpu 3,445 total
// 2,81s user 1,14s system 120% cpu 3,289 total

// GraphQL only for the username, parallel, print asap 
// 2,89s user 1,24s system 127% cpu 3,244 total
// 3,01s user 1,34s system 129% cpu 3,352 total

// GraphQL all 
// 0,32s user 0,17s system 32% cpu 1,505 total
// 0,34s user 0,18s system 35% cpu 1,499 total
```

### Comparing Performances: In the gh-submodule extension

Improvement of the algorithm unifying in a single query all the queries to check when repos are empty

Times for only queries to search for the repos and check what are empty:

| REST -n | GraphQL -n |
| :---:   | :---:      |
| 11,8    |  2,1       |

Plus downloading 16 repos:

| REST  | GraphQL | Parallel |
| :---: | :---:   | :---:    |
| 33,9  | 24      |  10,5    |


### Both Parallel and unified GraphQL queries 

Number of concurrent processes vs. time

|1     | 2       |  3   | 4         |   5   |   6     | 7        |  8    |
| :---:| :---:   | :---:|:---:      | :---: | :---:   | :---:    | :---: |
|  23,4|  16,    | 14,7 | 11,8      | 11,6  |  11     | 11,6     |  11,4  |  

```
graphql 

with 1 download -o ULL-MII-SYTWS-2122  1,64s user 0,63s system 31% cpu 7,297 total
with -n option nodownload -o ULL-MII-SYTWS-2122 0,39s user 0,15s system 26% cpu 2,040 total

16 repos no downloads 0,39s user 0,16s system 22% cpu 2,495 total
16 repos  downloaded 5,96s user 3,25s system 27% cpu 33,934 total

rest not unified request 

16 repos no download 2,33s user 0,83s system 26% cpu 11,815 total
16 repos  downloaded  5,83s user 3,17s system 25% cpu 35,026 total

```


Can't parallelize the downloads of submodules with `git submodule` due to race conditions. `git` complains:

```
Otro proceso git parece estar corriendo en el repositorio, es decir
un editor abierto con 'git commit'. Por favor asegúrese de que todos los procesos
están terminados y vuelve a intentar. Si el fallo permanece, un proceso git
puede haber roto el repositorio antes:
borra el archivo manualmente para continuar.
```

However `git clone`can be done in parallel and so an idea to explore is to make a parallel battery of all `git clone`s
and later a `git submodule add`

```
gh submodule-add -s aprender-markdown --org ULL-MFP-AET-2122  4,30s user 2,87s system 57% cpu 12,540 total 4 processes
gh submodule-add -s aprender-markdown --org ULL-MFP-AET-2122  4,29s user 2,82s system 80% cpu 8,783 total  8 processes
```

## Notes about the Lab "GitHub Cli" 

* [gh cli]({{site.baseurl}}/practicas/06p6-t1-gh-cli.html#extension)

Some of you have already written a [gh extension]({{site.baseurl}}/tema1-introduccion/gh#extension) using Node.JS. Let's have a look at these.

**Instructions about the  delivery**: 

Create a repo for your extension in a repo `ULL-MII-SYTWS-2122/gh-my-extension-name`  inside the classroom organization `ULL-MII-SYTWS-2122`. Add that repo as a `git submodule` to the repo associated to this lab assignment. Just leave the link to the assignment and extensions repos in the campus virtual 

## Lab: GraphQL-Simple-Server

Continue studying the basics of express and GraphQL

* [GraphQL-Simple-Server]({{site.baseurl}}/practicas/graphql-simple-server/#resolvers)

See the hello graphQL example at <https://github.com/crguezl/learning-graphql-with-gh/tree/main/graphql-beginner-series>

## Lab: npm module

* [npm module]({{site.baseurl}}/practicas/npm-module)

## Lab: GraphQL-Simple-Client 

* [GraphQL-Simple-Client]({{site.baseurl}}/practicas/graphql-simple-client/)


## References

* [GraphQL: Execution](https://graphql.org/learn/execution/)